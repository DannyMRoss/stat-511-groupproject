\documentclass[11pt]{article} 

\usepackage[margin=1in]{geometry}
\usepackage[onehalfspacing]{setspace}
\usepackage{indentfirst}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{float}
\usepackage{xcolor}

\title{\textbf{STAT 511 Group Project}}
\author{Chengyuan $\diamond$ Daniel $\diamond$ Junjie}

\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{Chengyuan $\diamond$ Daniel $\diamond$ Junjie}
\fancyhead[L]{STAT 511 - Group Project}
\fancyfoot[C]{\thepage}
\setlength{\headheight}{15pt}

\newcommand{\teh}{treatment effect heterogeneity}
\newcommand{\hte}{heterogeneous treatment effects}

\begin{document}
\maketitle

\section{Problem Description and Modeling Objective}
%Provide a clear statement of the problem being investigated in the paper. Clearly state the specific objective of the statistical modeling.

In the paper ``Estimating treatment effect heterogeneity in randomized program evaluation,''\cite{imai_estimating_2013} the authors are concerned with ``treatment effect heterogeneity'' which they define as ``the degree to which different treatments have differential causal effects on each unit.'' 
The authors' objective is to estimate \teh\ in order to (1) select the most effective treatment among a large number of available treatments, (2) design optimal treatments for sub-groups of units, (3) test the existence of \teh, and (4) generalize causal effect estimates from a sample to a target population.

\section{Data Description and Availability of Dataset}
%Provide a detailed overview of the dataset used (from the main application), including information about the variables in the dataset.

The \texttt{R} package \texttt{FindIt} includes the data from two well-known randomized evaluation studies in the social sciences that the authors' apply their model to.\cite{FindIt2012} 
Including the dataset \texttt{GerberGreen}, which is data from the 1998 New Haven Get-Out-the-Vote filed experiment where many different mobilization techniques were randomly administered to voters in the 1998 election.
As well as the dataset \texttt{LaLonde}, which is data from the national supported work (NSW) program that was a job training program intended to increase earnings of workers conducted from 1975 to 1978 over 15 sites in the United States.

\subsection{Gerber and Green (1998) New Haven Get-Out-the-Vote}

Table~\ref{tab:GerberGreen} provides a preview of the \texttt{GerberGreen} dataset. This dataset includes one outcome variable, four treatment variables, and four pre-treatment control covariates.
Specifically, \texttt{voted98} is a binary outcome variable of whether a registered voter voted or not in the 1998 election;
\texttt{persngrp} is a binary treatment variable of whether a personal visit of a registered voter was made;
\texttt{phnscrpt} is a categorical treatment variable with 7 levels (0 - no phone call, 1 - donate blood, 2 - civic appeal, 3 - civic appeal/donate blood, 4 - neighborhood solidarity, 5 - civic appeal/neighborhood solidarity, 6 - close election), for the phone message scripts read to registered voters;
\texttt{mailings} is an ordinal treatment variable of the number (0-3) of mailings sent to voters;
\texttt{appeal} is a categorical treatment variable with 3 levels (1 - civic duty, 2 - neighborhood solidarity, 3 - close election) for the content of the appeal made to registered voters;
\texttt{age} is an ordinal control for the age of the registered voter;
\texttt{majorpty} is a binary control for whether the registered voter was registered with either the Democratic or Republican part (1) or not (0);
\texttt{vote96.1} is a binary control for whether the registered voter voted in the 1996 election;
\texttt{vote96.0} is a binary control for whether the registered voter abstained in the 1996 election.

Of the 14,774 registered voters collected in \texttt{GerberGreen}, 5,879 (39.8\%), voted in the 1998 election.
Figure~\ref{fig:gerbergreentreatments} provides the proportion that voted in the 1998 election by the levels of each of the four treatment types.
Whereas, Figure~\ref{fig:gerbergreencontrols} provides the proportion that voted in the 1998 election by the levels of each of the four pre-treatment controls.

Further, Table~\ref{tab:GerberGreenTreatmentInteraction} provides a breakdown of the proportion of registered voters that voted in 1998 by each of the combinations of the four treatment variables present in \texttt{GerberGreen}.
Note, in the original experiment design there were 193 unique treatment combinations randomly administered to registered voters; however, the authors limited their study to single voter households to avoid interference among voters in the same household and thus only 72 treatment combinations are present in the subsetted data.
Finally, Table~\ref{tab:GerberGreenControlInteraction} provides a breakdown of the proportion of registered voters that voted in 1998 by each of the combinations of the pre-treatment control covariates.

\input{tbls/GerberGreentbl.tex}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{figs/GerberGreenTreatments.png}
    \caption{Voting Outcome by Treatment Type}
    \label{fig:gerbergreentreatments}
\end{figure}

\begin{figure}[p]
    \centering
    \includegraphics[width=\textwidth]{figs/GerberGreenControls.png}
    \caption{Voting Outcome by Pre-Treatment Control}
    \label{fig:gerbergreencontrols}
\end{figure}


\input{tbls/GerberGreenTreatmentInteraction.tex}

\input{tbls/GerberGreenControlInteraction.tex}

{\color{red} [[Add summary of main results from above visualizations]]}

\subsection{LaLonde (1996) National Supported Work Study}

Table~\ref{tab:LaLonde} provides a preview of the \texttt{LaLonde} dataset. This dataset includes one binary outcome variable, one binary treatment variable, and ten pre-treatment control covariates.
Specifically, \texttt{outcome} is a binary outcome variable of whether earnings in 1978 are larger than in 1975;
\texttt{treat} is a binary treatment variable for whether an individual received the job training or not;
\texttt{age} is an ordinal control for the age in years of workers;
\texttt{educ} is an ordinal control for the years of education of workers;
\texttt{black} is a binary control for whether the worker is black or not;
\texttt{hisp} is a binary control for whether the worker is Hispanic or not;
\texttt{white} is a binary control for whether the worker is white or not;
\texttt{marr} is a binary control for whether the worker is married or not;
\texttt{nodegr} is a binary control for whether the worker has a high school degree or not;
\texttt{log.re75} is a continuous control for workers pre-treatment log earnings in 1975;
\texttt{u75} is a binary control for whether the worker was unemployed in 1975 or not.
%\texttt{wts.extrap}

\input{tbls/LaLondetbl.tex}

Of the 722 workers in \texttt{LaLonde}, 408 (56.5\%), had larger earnings in 1978 compared to 1975.
Figure~\ref{fig:lalondetreatments} provides the proportion that had larger earnings in the control and treatment groups.
Whereas, Figure~\ref{fig:lalondecontrols} provides the proportion that had larger earnings by the levels of each of the pre-treatment controls.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{figs/LaLondeTreatments.png}
    \caption{Earnings Outcome by Treatment}
    \label{fig:lalondetreatments}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{figs/LaLondeControls.png}
    \caption{Earnings Outcome by Pre-Treatment Control}
    \label{fig:lalondecontrols}
\end{figure}

{\color{red} [[Add summary of main results from above visualizations]]}

\section{Model and Methods Description}
%Clearly describe the proposed model in the analysis. Outline the statistical estimation methods. For the proposed inference methods, provide an algorithm (e.g.,  with sufficient detail to implement the methods, using the input described in the Data Description section.

\subsection{Framework}

In order to overcome the methodological challenges of (1) extracting useful information from sparse randomized evaluation study data, (2) identifying sub-groups for whom a treatment is beneficial, and (3) generalizing the results of an experiment to a target population, the authors' formulate the estimation of heterogeneous treatment effects as a variable selection problem.
Specifically, the paper develops a Squared Loss Support Vector Machine (L2-SVM) with separate LASSO constraints over the pre-treatment and causal heterogeneity parameters, such that the causal heterogeneity variables of interest are separated from the rest of the variables. 

The proposed model is grounded within the potential outcomes framework for causal inference.
In this framework, the causal effect of treatment $t$ for unit $i$ is defined as $Y_i(t) - Y_i(0)$, where $Y_i$ is the potential outcome for unit $i$ under treatment or control.
Thus, by leveraging the fact that the L2-SVM is an optimal classifier, the proposed model can estimate \hte\ by predicting the potential outcomes $Y_i(t)$ directly from the fitted model and estimate the conditional treatment effect as the difference between the predicted outcome under treatment status $t$ and under the control condition.

To fit the proposed model the authors' use an estimation algorithm based on a generalized cross-validation (GCV) statistic.
Because of the structure of the proposed model, the SVM becomes a least squares problem on a subset of the data, therefore the L2-SVM is fitted through a series of iterated LASSO fits.
Accordingly, the authors' employ an efficient coordinate descent algorithm for the LASSO fits. 

\subsection{Model}

For modeling, the authors transform the binary outcome to $Y_i^* = 2Y_i - 1 \in \{\pm1\}$ and then relate the estimated binary outcome $\hat{Y_i} \in \{\pm1\}$ to the estimated latent variable $\hat{W_i} \in \mathbb{R}$, where \[\hat{Y_i} = \operatorname{sgn}(\hat{W_i})\quad\text{and}\quad\hat{W_i} = \hat{\mu} + \hat{\beta}^{\top}Z_i + \hat{\gamma}^{\top}V_i,\] here $Z_i$ is an $L_Z$ dimensional vector of treatment effect heterogeneity variables and $V_i$ is an $L_V$ dimensional vector containing the remaining control covariates.
Thus, the causal heterogeneity variables of interest, $Z_i$, are separated from the rest of the variables.

In order to estimate the parameters $(\beta, \gamma)$ the authors adapt a support vector machine (SVM) classifier and place separate LASSO constraints over each set of coefficients. 
Specifically, the estimates are given by the objective function \[(\hat{\beta}, \hat{\gamma}) = \underset{(\beta, \gamma)}{\text{arg min}} \sum_{i=1}^{n} w_i \cdot |1-Y_i^* \cdot(\mu + \beta^{\top}Z_i + \gamma^{\top}V_i)|^2_{+} + \lambda_Z \sum_{j=1}^{L_Z} |\beta_j| + \lambda_V \sum_{j=1}^{L_V}|\gamma_j|,\] where $\lambda_Z$ and $\lambda_V$ are pre-determined separate LASSO penalty parameters and $w_i$ is an optional sampling weight for generalizing results from a sample to a target population.
Here, the authors formulate the SVM as a penalized squared hinge-loss objective function (L2-SVM) where the hinge-loss is defined as $|x|_+ \equiv \max(x,0)$. 

\subsection{Estimating heterogeneous treatment effects}

By leveraging the fact that the L2-SVM is an optimal classifier, the proposed model can estimate \hte\ by predicting the potential outcomes $Y_i(t)$ directly from the fitted model and estimate the conditional treatment effect (CTE) as the difference between the predicted outcome under treatment status $t$ and under the control condition: $\hat{\delta}(t; \tilde{X}_i) = \frac{1}{2}(\hat{Y}_i(t) - \hat{Y}_i(0))$.
Further, the model can estimate the conditional average treatment effect (CATE), which is defined as $\tau(t; \tilde{x}) = \mathbb{E}(Y_i(t) - Y_i(0)\,|\,\tilde{X}_i = \tilde{x})$, for a given covariate profile $\tilde{x}$.
Specifically, the authors define $\hat{W}_i^*(t)$ as the predicted $\hat{W}_i^*(t)$ values truncated at positive and negative one.
Then the CATE is estimated as the difference in truncated values of the predicted outcome variables, $\hat{\tau}(t; \tilde{X}_i) = \frac{1}{2}(\hat{W}_i^*(t) - \hat{W}_i^*(0))$. 
While not a true difference in probabilities, the authors argue that $\hat{\tau}(t; \tilde{X}_i)$ provides a reasonable approximation of the CATE. 

\subsection{Estimating algorithm}

\section{Reproducing Results}

\section{Results}

\subsection{Selecting the best get-out-the-vote mobilization strategies}

To fit their proposed model to the \texttt{GerberGreen} data, the authors transform \texttt{voted98} to $\{\pm1\}$, define $Z_i$ as 192 binary indicator variables for the 192 possible treatment combinations, such that $K_Z = 192$, and define $V_i$ as the pre-treatment control covariates including the four main effects of \texttt{age}, \texttt{majorpty}, \texttt{vote96.1}, \texttt{vote96.0}; five two-way interaction terms: \texttt{age}:\texttt{majorpty}, \texttt{age}:\texttt{vote96.1}, \texttt{age}:\texttt{vote96.0}, \texttt{majorpty}:\texttt{vote96.1}, and \texttt{vote96.1}:\texttt{vote96.0}; and \texttt{age}$^2$, such that $K_V = 10$.

The authors find that 15 of the 192 treatment effect combinations are estimated as nonzero. 
Notably, they find that canvassing in person, i.e., \texttt{persngrp} $=1$, is the most effective GOTV technique.
Specifically, they find that compared to the baseline of no treatment of any type administered, registered voters that received a personal visit were 2.69 percentage points more likely to vote.
Further, they find that all mobilization strategies with a phone call and no personal visit either have no effect on voter turnout or are estimated to decrease voter turnout.
For example, they find that the mobilization strategy of (\texttt{persngrp} $=0$, \texttt{phnscrpt} $=2-$civic appeal, \texttt{mailings} $=3$, \texttt{appeal} $=2-$ neighborhood solidarity) was estimated to decrease voter turnout by 4.12 percentage points compared to the baseline.
Moreover, they find that the most effective treatment combination without canvassing was three mailings with a civic responsibility message and no phone calls, which was estimated to increase voter turnout by 1.17 percentage points.
This result is relevant because canvassing is the most expensive mobilization strategy.

Therefore, the authors conclude that in the presence of canvassing, the additional treatments of phone calls or mailings will lessen the canvassing's effectiveness. And if voters are not canvassed, they should be treated with three mailings with a civi duty appeal. 

\subsection{Identifying workers for whom job training is beneficial}

In the application of their model to the \texttt{LaLonde} dataset, the authors (1) identify groups of workers for whom the training program is beneficial, and (2) generalize the results based on this experiment to a target population, where the target population is a 1978 panel study of income dynamics (PSID) that oversamples low-income individuals.

 To fit their proposed model to the \texttt{LaLonde} data, the authors transform \texttt{outcome} to $\{\pm1\}$.
 Then they define the pre-treatment control covariates $V$ as as the 12 main effects of \texttt{age}, \texttt{age}$^2$, \texttt{educ}, \texttt{educ}$^2$, \texttt{log.re75}, \texttt{log.re75}$^2$, \texttt{black}, \texttt{hisp}, \texttt{white}, \texttt{marr}, \texttt{nodegr}, and \texttt{u75}; and 32 two-way interaction terms between the pre-treatment control covariates\footnote{The race indicators are not interacted with each other.}. Such that $K_V = 44$. 
The causal heterogeneity variables $Z$ include the binary treatment \texttt{treat} and the 44 interaction terms between \texttt{treat} and the pre-treatment controls. Thus, $K_Z = 45$.

Overall, the model produces an ATE estimate of 7.61 percentage points for the NSW sample, meaning that workers that received the job training were 7.61 percentage points more likely to have their earnings increase from 1975 to 1978 than those who did not receive the treatment.
Crucially, the model is able to identify groups of workers for whom the training program is helpful/harmful.
Specifically, the model finds that the CATE for groups of low education, non-Hispanic, high earning workers was as high as 53 percentage points.
However, the CATE for groups of high earning Hispanic workers was as low as -21 percentage points.




\section{Conclusion}

% Bibliography ----------------------
\bibliographystyle{plain}
\bibliography{../bibliography}

\end{document}  